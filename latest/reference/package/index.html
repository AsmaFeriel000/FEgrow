
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="An open-source molecular builder and free energy preparation workflow">
      
      
      
        <link rel="canonical" href="https://github.com/cole-group/FEgrow/latest/reference/package/">
      
      
        <link rel="prev" href="../conformers/">
      
      
        <link rel="next" href="../receptor/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.7">
    
    
      
        <title>package - FEgrow</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-blue" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#fegrow.package" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="FEgrow" class="md-header__button md-logo" aria-label="FEgrow" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FEgrow
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> package
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/cole-group/FEgrow" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    cole-group/FEgrow
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../installation/" class="md-tabs__link">
        
  
    
  
  Installation

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../notebooks/notebook1-basic-tutorial-full/1_basic_tutorial_full/" class="md-tabs__link">
          
  
    
  
  Notebooks

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../api/rmol/" class="md-tabs__link">
          
  
    
  
  API

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../acknowledgments/" class="md-tabs__link">
        
  
    
  
  Acknowledgments

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../license/" class="md-tabs__link">
        
  
    
  
  License

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="FEgrow" class="md-nav__button md-logo" aria-label="FEgrow" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    FEgrow
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cole-group/FEgrow" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    cole-group/FEgrow
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Notebooks
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Notebooks
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/notebook1-basic-tutorial-full/1_basic_tutorial_full/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1: Basic Full Tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/notebook2-mini-tutorial-grow-linker-and-r-group/2_mini_tutorial_grow_linker_rgroup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2: Mini - Grow Linker and R-Group
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/notebook2.1-tutorial-single-molecule/2_tutorial_single_mol/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2.1: Single Molecule
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/notebook3-mini-tutorial-replace-substructure/3_mini_tutorial_replace_substructure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3: Mini - replace substructure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/notebook4-introduce-chemspace/4_tutorial_introduce_chemspace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4: Introduce Chemspace
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/notebook5-chemspace-streamlined/5_tutorial_chemspace_streamlined/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5: Chemspace streamlined
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/notebook6-chemspace-smiles/6_chemspace_smiles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6: Chemspace with SMILES
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/notebook7-al-enamine/7_active_learning_enamine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7: Active Learning and Enamine
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/notebook8-more-al/8_active_learning_details/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8: Active Learning - Details
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notebooks/notebook9-previous-study50k/9_cs50k_study/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9: Pre-evaluated CS50K with Active Learning
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/rmol/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RMol
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/chemspace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ChemSpace
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/al/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Active Learning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> fegrow
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4_1" id="__nav_4_4_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_4_1">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> fegrow
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../al/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> al
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../builder/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> builder
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4_1_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../cli/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> cli
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4_1_4" id="__nav_4_4_1_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_4_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4_1_4">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> cli
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/cli/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> cli
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/scoring/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> scoring
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cli/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> utils
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../conformers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> conformers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> package
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> package
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fegrow.package.RInterface" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RInterface
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fegrow.package.RMol" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RMol
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" RMol">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.toxicity" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;toxicity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.generate_conformers" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;generate_conformers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.optimise_in_receptor" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;optimise_in_receptor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.sort_conformers" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;sort_conformers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.rep2D" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;rep2D
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.rep3D" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;rep3D
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.remove_clashing_confs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;remove_clashing_confs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.set_gnina" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;set_gnina
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol._check_download_gnina" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_check_download_gnina
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.gnina" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;gnina
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.to_file" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;to_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.df" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fegrow.package.DaskTasks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DaskTasks
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" DaskTasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fegrow.package.DaskTasks.scaffold_check" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;scaffold_check
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ChemSpace
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" ChemSpace">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.optimise_in_receptor" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;optimise_in_receptor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.discard_missing" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;discard_missing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.add_rgroups" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_rgroups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.add_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.add_smiles" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_smiles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace._evaluate_experimental" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_evaluate_experimental
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;evaluate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.add_enamine_molecules" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_enamine_molecules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.active_learning" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;active_learning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.compute_fps" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;compute_fps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.to_sdf" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;to_sdf
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fegrow.package.RGroups" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RGroups
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" RGroups">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RGroups._load_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_load_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fegrow.package.Linkers" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Linkers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fegrow.package.build_molecule" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_molecule
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fegrow.package._evaluate_atomic" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;_evaluate_atomic
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../receptor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> receptor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sascorer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> sascorer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4_1_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../testing/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> testing
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_4_1_9" id="__nav_4_4_1_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_4_1_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4_1_9">
            <span class="md-nav__icon md-icon"></span>
            <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> testing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/conftest/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> conftest
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/library_gen/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> library_gen
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/run_al/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> run_al
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/test_chemspace/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> test_chemspace
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../testing/test_general/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> test_general
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../toxicity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> toxicity
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../acknowledgments/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Acknowledgments
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../license/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    License
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#fegrow.package.RInterface" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RInterface
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fegrow.package.RMol" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RMol
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" RMol">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.toxicity" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;toxicity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.generate_conformers" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;generate_conformers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.optimise_in_receptor" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;optimise_in_receptor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.sort_conformers" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;sort_conformers
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.rep2D" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;rep2D
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.rep3D" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;rep3D
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.remove_clashing_confs" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;remove_clashing_confs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.set_gnina" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;set_gnina
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol._check_download_gnina" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_check_download_gnina
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.gnina" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;gnina
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.to_file" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;to_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RMol.df" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fegrow.package.DaskTasks" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;DaskTasks
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" DaskTasks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fegrow.package.DaskTasks.scaffold_check" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;scaffold_check
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;ChemSpace
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" ChemSpace">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.optimise_in_receptor" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;optimise_in_receptor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.discard_missing" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;discard_missing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.add_rgroups" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_rgroups
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.add_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.add_smiles" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_smiles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace._evaluate_experimental" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_evaluate_experimental
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.evaluate" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;evaluate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.add_enamine_molecules" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;add_enamine_molecules
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.active_learning" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;active_learning
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.compute_fps" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;compute_fps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fegrow.package.ChemSpace.to_sdf" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;to_sdf
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fegrow.package.RGroups" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;RGroups
    </span>
  </a>
  
    <nav class="md-nav" aria-label=" RGroups">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fegrow.package.RGroups._load_data" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;_load_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fegrow.package.Linkers" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;Linkers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fegrow.package.build_molecule" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;build_molecule
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#fegrow.package._evaluate_atomic" class="md-nav__link">
    <span class="md-ellipsis">
      <code class="doc-symbol doc-symbol-toc doc-symbol-function"></code>&nbsp;_evaluate_atomic
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<div class="doc doc-object doc-module">



<h1 id="fegrow.package" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-module"></code>            <span class="doc doc-object-name doc-module-name">package</span>


<a href="#fegrow.package" class="headerlink" title="Permanent link">#</a></h1>

    <div class="doc doc-contents first">







<p><span class="doc-section-title">Classes:</span></p>
    <ul>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-class&quot;&gt;&lt;/code&gt;&amp;nbsp;RInterface (&lt;code&gt;fegrow.package.RInterface&lt;/code&gt;)" href="#fegrow.package.RInterface">RInterface</a></code></b>
          –
          <div class="doc-md-description">
            <p>This is a shared interface for a molecule and a list of molecules.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-class&quot;&gt;&lt;/code&gt;&amp;nbsp;RMol (&lt;code&gt;fegrow.package.RMol&lt;/code&gt;)" href="#fegrow.package.RMol">RMol</a></code></b>
          –
          <div class="doc-md-description">
            <p>RMol is essentially a wrapper around RDKit Mol with</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-class&quot;&gt;&lt;/code&gt;&amp;nbsp;DaskTasks (&lt;code&gt;fegrow.package.DaskTasks&lt;/code&gt;)" href="#fegrow.package.DaskTasks">DaskTasks</a></code></b>
          –
          <div class="doc-md-description">
            
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-class&quot;&gt;&lt;/code&gt;&amp;nbsp;ChemSpace (&lt;code&gt;fegrow.package.ChemSpace&lt;/code&gt;)" href="#fegrow.package.ChemSpace">ChemSpace</a></code></b>
          –
          <div class="doc-md-description">
            <p>Streamline working with many RMols or a specific chemical space by employing a pandas dataframe,</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-class&quot;&gt;&lt;/code&gt;&amp;nbsp;RGroups (&lt;code&gt;fegrow.package.RGroups&lt;/code&gt;)" href="#fegrow.package.RGroups">RGroups</a></code></b>
          –
          <div class="doc-md-description">
            <p>The default R-Group library with visualisation (mols2grid).</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
          <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-class&quot;&gt;&lt;/code&gt;&amp;nbsp;Linkers (&lt;code&gt;fegrow.package.Linkers&lt;/code&gt;)" href="#fegrow.package.Linkers">Linkers</a></code></b>
          –
          <div class="doc-md-description">
            <p>A linker library presented as a grid molecules using mols2grid library.</p>
          </div>
        </li>
    </ul>




<p><span class="doc-section-title">Functions:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-function&quot;&gt;&lt;/code&gt;&amp;nbsp;build_molecule (&lt;code&gt;fegrow.package.build_molecule&lt;/code&gt;)" href="#fegrow.package.build_molecule">build_molecule</a></code></b>
            –
            <div class="doc-md-description">
              <p>:param scaffolds:</p>
            </div>
          </li>
    </ul>





  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="fegrow.package.RInterface" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">RInterface</span>


<a href="#fegrow.package.RInterface" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">


        <p>This is a shared interface for a molecule and a list of molecules.</p>
<p>The main purpose is to allow using the same functions on a single molecule and on a group of them.</p>













  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fegrow.package.RMol" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">RMol</span>


<a href="#fegrow.package.RMol" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">RMol</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-class&quot;&gt;&lt;/code&gt;&amp;nbsp;RInterface (&lt;code&gt;fegrow.package.RInterface&lt;/code&gt;)" href="#fegrow.package.RInterface">RInterface</a></code>, <code><span title="rdkit.Chem.rdchem.Mol">Mol</span></code></p>


        <p>RMol is essentially a wrapper around RDKit Mol with
tailored functionalities for attaching R groups, etc.</p>
<p>:param rmol: when provided, energies and additional metadata is preserved.
:type rmol: RMol
:param template: Provide the original molecule template
    used for this RMol.</p>









<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;toxicity (&lt;code&gt;fegrow.package.RMol.toxicity&lt;/code&gt;)" href="#fegrow.package.RMol.toxicity">toxicity</a></code></b>
            –
            <div class="doc-md-description">
              <p>Assessed various ADMET properties, including</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;generate_conformers (&lt;code&gt;fegrow.package.RMol.generate_conformers&lt;/code&gt;)" href="#fegrow.package.RMol.generate_conformers">generate_conformers</a></code></b>
            –
            <div class="doc-md-description">
              <p>Generate conformers using the RDKIT's ETKDG. The generated conformers</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;optimise_in_receptor (&lt;code&gt;fegrow.package.RMol.optimise_in_receptor&lt;/code&gt;)" href="#fegrow.package.RMol.optimise_in_receptor">optimise_in_receptor</a></code></b>
            –
            <div class="doc-md-description">
              <p>Enumerate the conformers inside of the receptor by employing</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;sort_conformers (&lt;code&gt;fegrow.package.RMol.sort_conformers&lt;/code&gt;)" href="#fegrow.package.RMol.sort_conformers">sort_conformers</a></code></b>
            –
            <div class="doc-md-description">
              <p>For the given molecule and the conformer energies order the energies</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;rep2D (&lt;code&gt;fegrow.package.RMol.rep2D&lt;/code&gt;)" href="#fegrow.package.RMol.rep2D">rep2D</a></code></b>
            –
            <div class="doc-md-description">
              <p>Use RDKit and get a 2D diagram.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;rep3D (&lt;code&gt;fegrow.package.RMol.rep3D&lt;/code&gt;)" href="#fegrow.package.RMol.rep3D">rep3D</a></code></b>
            –
            <div class="doc-md-description">
              <p>Use py3Dmol to obtain the 3D view of the molecule.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;remove_clashing_confs (&lt;code&gt;fegrow.package.RMol.remove_clashing_confs&lt;/code&gt;)" href="#fegrow.package.RMol.remove_clashing_confs">remove_clashing_confs</a></code></b>
            –
            <div class="doc-md-description">
              <p>Removing conformations that class with the protein.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;set_gnina (&lt;code&gt;fegrow.package.RMol.set_gnina&lt;/code&gt;)" href="#fegrow.package.RMol.set_gnina">set_gnina</a></code></b>
            –
            <div class="doc-md-description">
              <p>Set the location of the binary file gnina. This could be your own compiled directory,</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;gnina (&lt;code&gt;fegrow.package.RMol.gnina&lt;/code&gt;)" href="#fegrow.package.RMol.gnina">gnina</a></code></b>
            –
            <div class="doc-md-description">
              <p>Use GNINA to extract CNNaffinity, which we also recalculate to Kd (nM)</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;to_file (&lt;code&gt;fegrow.package.RMol.to_file&lt;/code&gt;)" href="#fegrow.package.RMol.to_file">to_file</a></code></b>
            –
            <div class="doc-md-description">
              <p>Write the molecule and all conformers to file.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;df (&lt;code&gt;fegrow.package.RMol.df&lt;/code&gt;)" href="#fegrow.package.RMol.df">df</a></code></b>
            –
            <div class="doc-md-description">
              <p>Generate a pandas dataframe row for this molecule with SMILES.</p>
            </div>
          </li>
    </ul>



                  <details class="quote">
                    <summary>Source code in <code>fegrow/package.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">RMol</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rdkit</span><span class="o">.</span><span class="n">Chem</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">template</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;template&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rgroup</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rgroup</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;rgroup&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt_energies</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">opt_energies</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;opt_energies&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;id&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="n">template</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rgroup</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opt_energies</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="fegrow.package.RMol.toxicity" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">toxicity</span>


<a href="#fegrow.package.RMol.toxicity" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">toxicity</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Assessed various ADMET properties, including
 - Lipinksi rule of 5 properties,
 - the presence of unwanted substructures
 - problematic functional groups
 - synthetic accessibility</p>
<p>:return: a row of a dataframe with the descriptors
 :rtype: dataframe</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">toxicity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Assessed various ADMET properties, including</span>
<span class="sd">     - Lipinksi rule of 5 properties,</span>
<span class="sd">     - the presence of unwanted substructures</span>
<span class="sd">     - problematic functional groups</span>
<span class="sd">     - synthetic accessibility</span>

<span class="sd">     :return: a row of a dataframe with the descriptors</span>
<span class="sd">     :rtype: dataframe</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">tox_props</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="c1"># add an index column to the front</span>
    <span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># add a column with smiles</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Smiles</span><span class="o">=</span><span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="bp">self</span><span class="p">)])</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.RMol.generate_conformers" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">generate_conformers</span>


<a href="#fegrow.package.RMol.generate_conformers" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">generate_conformers</span><span class="p">(</span><span class="n">num_conf</span><span class="p">:</span> <span class="n"><span title="int">int</span></span><span class="p">,</span> <span class="n">minimum_conf_rms</span><span class="p">:</span> <span class="n"><span title="typing.Optional">Optional</span></span><span class="p">[</span><span class="n"><span title="float">float</span></span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate conformers using the RDKIT's ETKDG. The generated conformers
are embedded into the template structure. In other words,
any atoms that are common with the template structure,
should have the same coordinates.</p>
<p>:param num_conf: fixme
:param minimum_conf_rms: The minimum acceptable difference in the RMS in any new generated conformer.
    Conformers that are too similar are discarded.
:type minimum_conf_rms: float
:param flexible: A list of indices that are common with the template molecule
    that should have new coordinates.
:type flexible: List[int]</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_conformers</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">num_conf</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">minimum_conf_rms</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate conformers using the RDKIT&#39;s ETKDG. The generated conformers</span>
<span class="sd">    are embedded into the template structure. In other words,</span>
<span class="sd">    any atoms that are common with the template structure,</span>
<span class="sd">    should have the same coordinates.</span>

<span class="sd">    :param num_conf: fixme</span>
<span class="sd">    :param minimum_conf_rms: The minimum acceptable difference in the RMS in any new generated conformer.</span>
<span class="sd">        Conformers that are too similar are discarded.</span>
<span class="sd">    :type minimum_conf_rms: float</span>
<span class="sd">    :param flexible: A list of indices that are common with the template molecule</span>
<span class="sd">        that should have new coordinates.</span>
<span class="sd">    :type flexible: List[int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cons</span> <span class="o">=</span> <span class="n">generate_conformers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_conf</span><span class="p">,</span> <span class="n">minimum_conf_rms</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">RemoveAllConformers</span><span class="p">()</span>
    <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">AddConformer</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">assignId</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">con</span> <span class="ow">in</span> <span class="n">cons</span><span class="o">.</span><span class="n">GetConformers</span><span class="p">()]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.RMol.optimise_in_receptor" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">optimise_in_receptor</span>


<a href="#fegrow.package.RMol.optimise_in_receptor" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">optimise_in_receptor</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Enumerate the conformers inside of the receptor by employing
ANI2x, a hybrid machine learning / molecular mechanics (ML/MM) approach.
ANI2x is neural nework potential for the ligand energetics
but works only for the following atoms: H, C, N, O, F, S, Cl.</p>
<p>Open Force Field Parsley force field is used for intermolecular interactions with the receptor.</p>
<p>:param sigma_scale_factor: is used to scale the Lennard-Jones radii of the atoms.
:param relative_permittivity: is used to scale the electrostatic interactions with the protein.
:param water_model: can be used to set the force field for any water molecules present in the binding site.</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">optimise_in_receptor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enumerate the conformers inside of the receptor by employing</span>
<span class="sd">    ANI2x, a hybrid machine learning / molecular mechanics (ML/MM) approach.</span>
<span class="sd">    ANI2x is neural nework potential for the ligand energetics</span>
<span class="sd">    but works only for the following atoms: H, C, N, O, F, S, Cl.</span>

<span class="sd">    Open Force Field Parsley force field is used for intermolecular interactions with the receptor.</span>

<span class="sd">    :param sigma_scale_factor: is used to scale the Lennard-Jones radii of the atoms.</span>
<span class="sd">    :param relative_permittivity: is used to scale the electrostatic interactions with the protein.</span>
<span class="sd">    :param water_model: can be used to set the force field for any water molecules present in the binding site.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetNumConformers</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Warning: no conformers so cannot optimise_in_receptor. Ignoring.&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">opt_mol</span><span class="p">,</span> <span class="n">energies</span> <span class="o">=</span> <span class="n">optimise_in_receptor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="c1"># replace the conformers with the optimised ones</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">RemoveAllConformers</span><span class="p">()</span>
    <span class="p">[</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddConformer</span><span class="p">(</span><span class="n">conformer</span><span class="p">,</span> <span class="n">assignId</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">conformer</span> <span class="ow">in</span> <span class="n">opt_mol</span><span class="o">.</span><span class="n">GetConformers</span><span class="p">()</span>
    <span class="p">]</span>
    <span class="c1"># save the energies</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_save_opt_energies</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>

    <span class="c1"># build a dataframe with the molecules</span>
    <span class="n">conformer_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">GetId</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetConformers</span><span class="p">()]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">energies</span><span class="p">),</span>
            <span class="s2">&quot;Conformer&quot;</span><span class="p">:</span> <span class="n">conformer_ids</span><span class="p">,</span>
            <span class="s2">&quot;Energy&quot;</span><span class="p">:</span> <span class="n">energies</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.RMol.sort_conformers" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">sort_conformers</span>


<a href="#fegrow.package.RMol.sort_conformers" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">sort_conformers</span><span class="p">(</span><span class="n">energy_range</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>For the given molecule and the conformer energies order the energies
 and only keep any conformers with in the energy range of the
 lowest energy conformer.</p>
<p>:param energy_range: The energy range (kcal/mol),
    above the minimum, for which conformers should be kept.</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">sort_conformers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy_range</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For the given molecule and the conformer energies order the energies</span>
<span class="sd">     and only keep any conformers with in the energy range of the</span>
<span class="sd">     lowest energy conformer.</span>

<span class="sd">    :param energy_range: The energy range (kcal/mol),</span>
<span class="sd">        above the minimum, for which conformers should be kept.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetNumConformers</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;An rmol doesn&#39;t have any conformers. Ignoring.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_energies</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
            <span class="s2">&quot;Please run the optimise_in_receptor in order to generate the energies first. &quot;</span>
        <span class="p">)</span>


    <span class="n">final_mol</span><span class="p">,</span> <span class="n">final_energies</span> <span class="o">=</span> <span class="n">sort_conformers</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_energies</span><span class="p">,</span> <span class="n">energy_range</span><span class="o">=</span><span class="n">energy_range</span>
    <span class="p">)</span>
    <span class="c1"># overwrite the current confs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">RemoveAllConformers</span><span class="p">()</span>
    <span class="p">[</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AddConformer</span><span class="p">(</span><span class="n">conformer</span><span class="p">,</span> <span class="n">assignId</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">conformer</span> <span class="ow">in</span> <span class="n">final_mol</span><span class="o">.</span><span class="n">GetConformers</span><span class="p">()</span>
    <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_save_opt_energies</span><span class="p">(</span><span class="n">final_energies</span><span class="p">)</span>

    <span class="c1"># build a dataframe with the molecules</span>
    <span class="n">conformer_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">GetId</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetConformers</span><span class="p">()]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">final_energies</span><span class="p">),</span>
            <span class="s2">&quot;Conformer&quot;</span><span class="p">:</span> <span class="n">conformer_ids</span><span class="p">,</span>
            <span class="s2">&quot;Energy&quot;</span><span class="p">:</span> <span class="n">final_energies</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.RMol.rep2D" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">rep2D</span>


<a href="#fegrow.package.RMol.rep2D" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">rep2D</span><span class="p">(</span><span class="n">idx</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">rdkit_mol</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Use RDKit and get a 2D diagram.
Uses Compute2DCoords and Draw.MolToImage function</p>
<p>Works with IPython Notebook.</p>
<p>:param **kwargs: are passed further to Draw.MolToImage function.</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rep2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">rdkit_mol</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use RDKit and get a 2D diagram.</span>
<span class="sd">    Uses Compute2DCoords and Draw.MolToImage function</span>

<span class="sd">    Works with IPython Notebook.</span>

<span class="sd">    :param **kwargs: are passed further to Draw.MolToImage function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">numbered</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">h</span><span class="p">:</span>
        <span class="n">numbered</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">RemoveHs</span><span class="p">(</span><span class="n">numbered</span><span class="p">)</span>

    <span class="n">numbered</span><span class="o">.</span><span class="n">RemoveAllConformers</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">idx</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">numbered</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">():</span>
            <span class="n">atom</span><span class="o">.</span><span class="n">SetAtomMapNum</span><span class="p">(</span><span class="n">atom</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">())</span>
    <span class="n">Chem</span><span class="o">.</span><span class="n">AllChem</span><span class="o">.</span><span class="n">Compute2DCoords</span><span class="p">(</span><span class="n">numbered</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">rdkit_mol</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">numbered</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Draw</span><span class="o">.</span><span class="n">MolToImage</span><span class="p">(</span><span class="n">numbered</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.RMol.rep3D" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">rep3D</span>


<a href="#fegrow.package.RMol.rep3D" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">rep3D</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prody</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">confIds</span><span class="p">:</span> <span class="n"><span title="typing.Optional">Optional</span></span><span class="p">[</span><span class="n"><span title="typing.List">List</span></span><span class="p">[</span><span class="n"><span title="int">int</span></span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Use py3Dmol to obtain the 3D view of the molecule.</p>
<p>Works with IPython Notebook.</p>
<p>:param view: a view to which add the visualisation. Useful if one wants to 3D view
    multiple conformers in one view.
:type view: py3Dmol view instance (None)
:param prody: A prody protein around which a view 3D can be created
:type prody: Prody instance (Default: None)
:param template: Whether to visualise the original 3D template as well from which the molecule was made.
:type template: bool (False)
:param confIds: Select the conformations for display.
:type confIds: List[int]</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">rep3D</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">view</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">prody</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">template</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">confIds</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use py3Dmol to obtain the 3D view of the molecule.</span>

<span class="sd">    Works with IPython Notebook.</span>

<span class="sd">    :param view: a view to which add the visualisation. Useful if one wants to 3D view</span>
<span class="sd">        multiple conformers in one view.</span>
<span class="sd">    :type view: py3Dmol view instance (None)</span>
<span class="sd">    :param prody: A prody protein around which a view 3D can be created</span>
<span class="sd">    :type prody: Prody instance (Default: None)</span>
<span class="sd">    :param template: Whether to visualise the original 3D template as well from which the molecule was made.</span>
<span class="sd">    :type template: bool (False)</span>
<span class="sd">    :param confIds: Select the conformations for display.</span>
<span class="sd">    :type confIds: List[int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">prody</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">prody_package</span><span class="o">.</span><span class="n">proteins</span><span class="o">.</span><span class="n">functions</span><span class="o">.</span><span class="n">view3D</span><span class="p">(</span><span class="n">prody</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">view</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">py3Dmol</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">viewergrid</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetConformers</span><span class="p">():</span>
        <span class="c1"># ignore the confIds we&#39;ve not asked for</span>
        <span class="k">if</span> <span class="n">confIds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">conf</span><span class="o">.</span><span class="n">GetId</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">confIds</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="n">mb</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolToMolBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">confId</span><span class="o">=</span><span class="n">conf</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="n">view</span><span class="o">.</span><span class="n">addModel</span><span class="p">(</span><span class="n">mb</span><span class="p">,</span> <span class="s2">&quot;lig&quot;</span><span class="p">)</span>

        <span class="c1"># use reverse indexing to reference the just added conformer</span>
        <span class="c1"># http://3dmol.csb.pitt.edu/doc/types.html#AtomSelectionSpec</span>
        <span class="c1"># cmap = plt.get_cmap(&quot;tab20c&quot;)</span>
        <span class="c1"># hex = to_hex(cmap.colors[i]).split(&#39;#&#39;)[-1]</span>
        <span class="n">view</span><span class="o">.</span><span class="n">setStyle</span><span class="p">({</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;stick&quot;</span><span class="p">:</span> <span class="p">{}})</span>

    <span class="k">if</span> <span class="n">template</span><span class="p">:</span>
        <span class="n">mb</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolToMolBlock</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">addModel</span><span class="p">(</span><span class="n">mb</span><span class="p">,</span> <span class="s2">&quot;template&quot;</span><span class="p">)</span>
        <span class="c1"># show as sticks</span>
        <span class="n">view</span><span class="o">.</span><span class="n">setStyle</span><span class="p">({</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="s2">&quot;stick&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;0xAF10AB&quot;</span><span class="p">}})</span>

    <span class="c1"># zoom to the last added model</span>
    <span class="n">view</span><span class="o">.</span><span class="n">zoomTo</span><span class="p">({</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">view</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.RMol.remove_clashing_confs" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">remove_clashing_confs</span>


<a href="#fegrow.package.RMol.remove_clashing_confs" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">remove_clashing_confs</span><span class="p">(</span><span class="n">protein</span><span class="p">:</span> <span class="n"><span title="typing.Union">Union</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="openmm.app.PDBFile">PDBFile</span></span><span class="p">],</span> <span class="n">min_dst_allowed</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Removing conformations that class with the protein.
Note that the original conformer should be well docked into the protein,
ideally with some space between the area of growth and the protein,
so that any growth on the template doesn't automatically cause
clashes.</p>
<p>:param protein: The protein against which the conformers should be tested.
:type protein: filename or the openmm PDBFile instance or prody instance
:param min_dst_allowed: If any atom is within this distance in a conformer, the
 conformer will be deleted.
:type min_dst_allowed: float in Angstroms</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_clashing_confs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">protein</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">PDBFile</span><span class="p">],</span> <span class="n">min_dst_allowed</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Removing conformations that class with the protein.</span>
<span class="sd">    Note that the original conformer should be well docked into the protein,</span>
<span class="sd">    ideally with some space between the area of growth and the protein,</span>
<span class="sd">    so that any growth on the template doesn&#39;t automatically cause</span>
<span class="sd">    clashes.</span>

<span class="sd">    :param protein: The protein against which the conformers should be tested.</span>
<span class="sd">    :type protein: filename or the openmm PDBFile instance or prody instance</span>
<span class="sd">    :param min_dst_allowed: If any atom is within this distance in a conformer, the</span>
<span class="sd">     conformer will be deleted.</span>
<span class="sd">    :type min_dst_allowed: float in Angstroms</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">protein</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">protein</span> <span class="o">=</span> <span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">PDBFile</span><span class="p">(</span><span class="n">protein</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">protein</span><span class="p">)</span> <span class="ow">is</span> <span class="n">openmm</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">PDBFile</span><span class="p">:</span>
        <span class="n">protein_coords</span> <span class="o">=</span> <span class="n">protein</span><span class="o">.</span><span class="n">getPositions</span><span class="p">(</span><span class="n">asNumpy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">in_units_of</span><span class="p">(</span><span class="n">openmm</span><span class="o">.</span><span class="n">unit</span><span class="o">.</span><span class="n">angstrom</span><span class="p">)</span><span class="o">.</span><span class="n">_value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">protein_coords</span> <span class="o">=</span> <span class="n">protein</span><span class="o">.</span><span class="n">getCoords</span><span class="p">()</span>

    <span class="n">rm_counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">conf</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetConformers</span><span class="p">()):</span>
        <span class="c1"># for each atom check how far it is from the protein atoms</span>
        <span class="n">min_dst</span> <span class="o">=</span> <span class="mi">999_999_999</span>  <span class="c1"># arbitrary large distance</span>

        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">conf</span><span class="o">.</span><span class="n">GetPositions</span><span class="p">():</span>
            <span class="n">shortest</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">point</span> <span class="o">-</span> <span class="n">protein_coords</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="n">min_dst</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_dst</span><span class="p">,</span> <span class="n">shortest</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">min_dst</span> <span class="o">&lt;</span> <span class="n">min_dst_allowed</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">RemoveConformer</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Clash with the protein. Removing conformer id: </span><span class="si">{</span><span class="n">conf</span><span class="o">.</span><span class="n">GetId</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">rm_counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">break</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed </span><span class="si">{</span><span class="n">rm_counter</span><span class="si">}</span><span class="s2"> conformers. &quot;</span><span class="p">)</span>

    <span class="c1"># return self for Dask</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.RMol.set_gnina" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">set_gnina</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#fegrow.package.RMol.set_gnina" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">set_gnina</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set the location of the binary file gnina. This could be your own compiled directory,
or a directory where you'd like it to be downloaded.</p>
<p>By default, gnina path is to the working directory (~500MB).</p>
<p>:param loc: path to gnina binary file. E.g. /dir/path/gnina. Note that right now gnina should
 be a binary file with that specific filename "gnina".
:type loc: str</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">set_gnina</span><span class="p">(</span><span class="n">loc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Set the location of the binary file gnina. This could be your own compiled directory,</span>
<span class="sd">    or a directory where you&#39;d like it to be downloaded.</span>

<span class="sd">    By default, gnina path is to the working directory (~500MB).</span>

<span class="sd">    :param loc: path to gnina binary file. E.g. /dir/path/gnina. Note that right now gnina should</span>
<span class="sd">     be a binary file with that specific filename &quot;gnina&quot;.</span>
<span class="sd">    :type loc: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># set gnina location</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
        <span class="k">assert</span> <span class="n">path</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;gnina&quot;</span><span class="p">,</span> <span class="s1">&#39;Please ensure gnina binary is named &quot;gnina&quot;&#39;</span>
        <span class="n">RMol</span><span class="o">.</span><span class="n">gnina_dir</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">parent</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;The path is not the binary file gnina&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.RMol._check_download_gnina" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">_check_download_gnina</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#fegrow.package.RMol._check_download_gnina" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">_check_download_gnina</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if gnina works. Otherwise, download it.</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_check_download_gnina</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if gnina works. Otherwise, download it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">RMol</span><span class="o">.</span><span class="n">gnina_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># assume it is in the current directory</span>
        <span class="n">RMol</span><span class="o">.</span><span class="n">gnina_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

    <span class="c1"># check if gnina works</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;./gnina&quot;</span><span class="p">,</span> <span class="s2">&quot;--help&quot;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">RMol</span><span class="o">.</span><span class="n">gnina_dir</span>
        <span class="p">)</span>
        <span class="k">return</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span> <span class="k">as</span> <span class="n">E</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># gnina is not found, try downloading it</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Gnina not found or set. Download gnina (~500MB) into </span><span class="si">{</span><span class="n">RMol</span><span class="o">.</span><span class="n">gnina_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">gnina</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RMol</span><span class="o">.</span><span class="n">gnina_dir</span><span class="p">,</span> <span class="s2">&quot;gnina&quot;</span><span class="p">)</span>
    <span class="c1"># fixme - currently download to the working directory (Home could be more applicable).</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span>
        <span class="s2">&quot;https://github.com/gnina/gnina/releases/download/v1.0.1/gnina&quot;</span><span class="p">,</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">gnina</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># make executable (chmod +x)</span>
    <span class="n">mode</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">gnina</span><span class="p">)</span><span class="o">.</span><span class="n">st_mode</span>
    <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="n">gnina</span><span class="p">,</span> <span class="n">mode</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IEXEC</span><span class="p">)</span>

    <span class="c1"># check if it works</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="p">[</span><span class="s2">&quot;./gnina&quot;</span><span class="p">,</span> <span class="s2">&quot;--help&quot;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cwd</span><span class="o">=</span><span class="n">RMol</span><span class="o">.</span><span class="n">gnina_dir</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.RMol.gnina" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">gnina</span>


<a href="#fegrow.package.RMol.gnina" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">gnina</span><span class="p">(</span><span class="n">receptor_file</span><span class="p">,</span> <span class="n">gnina_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Use GNINA to extract CNNaffinity, which we also recalculate to Kd (nM)</p>
<p>LIMITATION: The GNINA binary does not support MAC/Windows.</p>
<p>Please cite GNINA accordingly:
McNutt, Andrew T., Paul Francoeur, Rishal Aggarwal, Tomohide Masuda, Rocco Meli, Matthew Ragoza,
Jocelyn Sunseri, and David Ryan Koes. "GNINA 1.0: molecular docking with deep learning."
Journal of cheminformatics 13, no. 1 (2021): 1-20.</p>
<p>:param receptor_file: Path to the receptor file.
:type receptor_file: str</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">gnina</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receptor_file</span><span class="p">,</span> <span class="n">gnina_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use GNINA to extract CNNaffinity, which we also recalculate to Kd (nM)</span>

<span class="sd">    LIMITATION: The GNINA binary does not support MAC/Windows.</span>

<span class="sd">    Please cite GNINA accordingly:</span>
<span class="sd">    McNutt, Andrew T., Paul Francoeur, Rishal Aggarwal, Tomohide Masuda, Rocco Meli, Matthew Ragoza,</span>
<span class="sd">    Jocelyn Sunseri, and David Ryan Koes. &quot;GNINA 1.0: molecular docking with deep learning.&quot;</span>
<span class="sd">    Journal of cheminformatics 13, no. 1 (2021): 1-20.</span>

<span class="sd">    :param receptor_file: Path to the receptor file.</span>
<span class="sd">    :type receptor_file: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">RMol</span><span class="o">.</span><span class="n">_check_download_gnina</span><span class="p">()</span>
    <span class="n">gnina_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RMol</span><span class="o">.</span><span class="n">gnina_dir</span><span class="p">,</span> <span class="s1">&#39;gnina&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">receptor_file</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">receptor_file</span><span class="p">,</span> <span class="n">Path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;gnina function requires a file path to the receptor. Instead, was given: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">receptor_file</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># get the absolute path</span>
    <span class="n">receptor</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">receptor_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">receptor</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Your receptor &quot;</span><span class="si">{</span><span class="n">receptor_file</span><span class="si">}</span><span class="s1">&quot; does not seem to exist.&#39;</span><span class="p">)</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">CNNaffinities</span> <span class="o">=</span> <span class="n">gnina</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receptor</span><span class="p">,</span> <span class="n">gnina_path</span><span class="p">,</span> <span class="n">gnina_gpu</span><span class="o">=</span><span class="n">gnina_gpu</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">RMol</span><span class="o">.</span><span class="n">_parse_gnina_cnnaffinities</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">CNNaffinities</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.RMol.to_file" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">to_file</span>


<a href="#fegrow.package.RMol.to_file" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">to_file</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Write the molecule and all conformers to file.</p>


<details class="note" open>
  <summary>Note</summary>
  <p>The file type is worked out from the name extension by splitting on <code>.</code>.</p>
</details>
            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write the molecule and all conformers to file.</span>

<span class="sd">    Note:</span>
<span class="sd">        The file type is worked out from the name extension by splitting on `.`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_type</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="n">writers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;.mol&quot;</span><span class="p">:</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolToMolFile</span><span class="p">,</span>
        <span class="s2">&quot;.sdf&quot;</span><span class="p">:</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SDWriter</span><span class="p">,</span>
        <span class="s2">&quot;.pdb&quot;</span><span class="p">:</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">PDBWriter</span><span class="p">,</span> <span class="n">flavor</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="s2">&quot;.xyz&quot;</span><span class="p">:</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolToXYZFile</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">func</span> <span class="o">=</span> <span class="n">writers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">file_type</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The file type </span><span class="si">{</span><span class="n">file_type</span><span class="si">}</span><span class="s2"> is not support please chose from </span><span class="si">{</span><span class="n">writers</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">file_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;.pdb&#39;</span><span class="p">,</span> <span class="s1">&#39;.sdf&#39;</span><span class="p">]:</span>
        <span class="c1"># multi-frame writers</span>

        <span class="k">with</span> <span class="n">writers</span><span class="p">[</span><span class="n">file_type</span><span class="p">](</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">WRITER</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">conformer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetConformers</span><span class="p">():</span>
                <span class="n">WRITER</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">confId</span><span class="o">=</span><span class="n">conformer</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="k">return</span>

    <span class="n">writers</span><span class="p">[</span><span class="n">file_type</span><span class="p">](</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.RMol.df" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">df</span>


<a href="#fegrow.package.RMol.df" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">df</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate a pandas dataframe row for this molecule with SMILES.</p>
<p>:returns: pandas dataframe row.</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">df</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a pandas dataframe row for this molecule with SMILES.</span>

<span class="sd">    :returns: pandas dataframe row.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;ID&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
            <span class="s2">&quot;Smiles&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="bp">self</span><span class="p">)],</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="c1"># attach energies if they&#39;re present</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">opt_energies</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span>
            <span class="n">Energies</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">opt_energies</span><span class="p">)])</span>
        <span class="p">)</span>

    <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;ID&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fegrow.package.DaskTasks" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">DaskTasks</span>


<a href="#fegrow.package.DaskTasks" class="headerlink" title="Permanent link">#</a></h2>


    <div class="doc doc-contents ">










<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;scaffold_check (&lt;code&gt;fegrow.package.DaskTasks.scaffold_check&lt;/code&gt;)" href="#fegrow.package.DaskTasks.scaffold_check">scaffold_check</a></code></b>
            –
            <div class="doc-md-description">
              <p>:param smih:</p>
            </div>
          </li>
    </ul>






  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="fegrow.package.DaskTasks.scaffold_check" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">scaffold_check</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#fegrow.package.DaskTasks.scaffold_check" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">scaffold_check</span><span class="p">(</span><span class="n">smih</span><span class="p">,</span> <span class="n">scaffold</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>:param smih:
:param scaffold:
:return: [has_scaffold_bool, protonated_smiles]</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="nd">@dask</span><span class="o">.</span><span class="n">delayed</span>
<span class="k">def</span><span class="w"> </span><span class="nf">scaffold_check</span><span class="p">(</span><span class="n">smih</span><span class="p">,</span> <span class="n">scaffold</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param smih:</span>
<span class="sd">    :param scaffold:</span>
<span class="sd">    :return: [has_scaffold_bool, protonated_smiles]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SmilesParserParams</span><span class="p">()</span>
    <span class="n">params</span><span class="o">.</span><span class="n">removeHs</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">mol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">smih</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">mol</span><span class="o">.</span><span class="n">HasSubstructMatch</span><span class="p">(</span><span class="n">scaffold</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">smih</span>

    <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fegrow.package.ChemSpace" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">ChemSpace</span>


<a href="#fegrow.package.ChemSpace" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">ChemSpace</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dask_cluster</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dask_local_cluster_kwargs</span><span class="o">=</span><span class="p">{})</span>
</code></pre></div>

    <div class="doc doc-contents ">


        <p>Streamline working with many RMols or a specific chemical space by employing a pandas dataframe,
in combination with Dask for parallellisation.</p>









<p><span class="doc-section-title">Methods:</span></p>
    <ul>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;optimise_in_receptor (&lt;code&gt;fegrow.package.ChemSpace.optimise_in_receptor&lt;/code&gt;)" href="#fegrow.package.ChemSpace.optimise_in_receptor">optimise_in_receptor</a></code></b>
            –
            <div class="doc-md-description">
              <p>Return lists of energies.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;discard_missing (&lt;code&gt;fegrow.package.ChemSpace.discard_missing&lt;/code&gt;)" href="#fegrow.package.ChemSpace.discard_missing">discard_missing</a></code></b>
            –
            <div class="doc-md-description">
              <p>Remove from this list the molecules that have no conformers</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;add_rgroups (&lt;code&gt;fegrow.package.ChemSpace.add_rgroups&lt;/code&gt;)" href="#fegrow.package.ChemSpace.add_rgroups">add_rgroups</a></code></b>
            –
            <div class="doc-md-description">
              <p>Note that if they are Smiles:</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;add_data (&lt;code&gt;fegrow.package.ChemSpace.add_data&lt;/code&gt;)" href="#fegrow.package.ChemSpace.add_data">add_data</a></code></b>
            –
            <div class="doc-md-description">
              <p>:param data: dictionary {"Smiles": [], "h": [], ... }</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;add_smiles (&lt;code&gt;fegrow.package.ChemSpace.add_smiles&lt;/code&gt;)" href="#fegrow.package.ChemSpace.add_smiles">add_smiles</a></code></b>
            –
            <div class="doc-md-description">
              <p>Add a list of Smiles into this ChemicalSpace</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;evaluate (&lt;code&gt;fegrow.package.ChemSpace.evaluate&lt;/code&gt;)" href="#fegrow.package.ChemSpace.evaluate">evaluate</a></code></b>
            –
            <div class="doc-md-description">
              <p>:param indices:</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;add_enamine_molecules (&lt;code&gt;fegrow.package.ChemSpace.add_enamine_molecules&lt;/code&gt;)" href="#fegrow.package.ChemSpace.add_enamine_molecules">add_enamine_molecules</a></code></b>
            –
            <div class="doc-md-description">
              <p>For the best scoring molecules, find similar molecules in Enamine REAL database</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;active_learning (&lt;code&gt;fegrow.package.ChemSpace.active_learning&lt;/code&gt;)" href="#fegrow.package.ChemSpace.active_learning">active_learning</a></code></b>
            –
            <div class="doc-md-description">
              <p>Model the data using the Training subset. Then use the active learning query method.</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;compute_fps (&lt;code&gt;fegrow.package.ChemSpace.compute_fps&lt;/code&gt;)" href="#fegrow.package.ChemSpace.compute_fps">compute_fps</a></code></b>
            –
            <div class="doc-md-description">
              <p>:param smiles_tuple: It has to be a tuple to be hashable (to work with caching).</p>
            </div>
          </li>
          <li class="doc-section-item field-body">
            <b><code><a class="autorefs autorefs-internal" title="&lt;code class=&quot;doc-symbol doc-symbol-toc doc-symbol-method&quot;&gt;&lt;/code&gt;&amp;nbsp;to_sdf (&lt;code&gt;fegrow.package.ChemSpace.to_sdf&lt;/code&gt;)" href="#fegrow.package.ChemSpace.to_sdf">to_sdf</a></code></b>
            –
            <div class="doc-md-description">
              <p>Write every molecule and all its fields as properties, to an SDF file.</p>
            </div>
          </li>
    </ul>



                  <details class="quote">
                    <summary>Source code in <code>fegrow/package.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dask_cluster</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dask_local_cluster_kwargs</span><span class="o">=</span><span class="p">{}):</span>
    <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">ChemSpace</span><span class="o">.</span><span class="n">DATAFRAME_DEFAULT_VALUES</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>

    <span class="n">ChemSpace</span><span class="o">.</span><span class="n">_dask_cluster</span> <span class="o">=</span> <span class="n">dask_cluster</span>

    <span class="k">if</span> <span class="n">ChemSpace</span><span class="o">.</span><span class="n">_dask_cluster</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No Dask cluster configured. Creating a local cluster of threads. &quot;</span><span class="p">)</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;ANI uses TORCHAni which is not threadsafe, leading to random SEGFAULTS. &quot;</span>
                      <span class="s2">&quot;Use a Dask cluster with processes as a work around &quot;</span>
                      <span class="s2">&quot;(see the documentation for an example of this workaround) .&quot;</span><span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;n_workers&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="s2">&quot;processes&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># turn off Nanny to avoid the problem</span>
                                       <span class="c1"># with loading of the main file (ie executing it)</span>
                  <span class="s2">&quot;dashboard_address&quot;</span><span class="p">:</span> <span class="s2">&quot;:8989&quot;</span><span class="p">,</span>
                  <span class="o">**</span><span class="n">dask_local_cluster_kwargs</span>
                  <span class="p">}</span>
        <span class="n">ChemSpace</span><span class="o">.</span><span class="n">_dask_cluster</span> <span class="o">=</span> <span class="n">LocalCluster</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># ChemSpace._dask_cluster = Scheduler()</span>
        <span class="c1"># ChemSpace._dask_cluster = LocalCluster(preload_nanny=[&quot;print(&#39;Hi Nanny&#39;)&quot;],</span>
        <span class="c1">#                                        preload=[&quot;pint&quot;], n_workers=1</span>
        <span class="c1">#                                        ) #asynchronous=True)</span>

    <span class="n">ChemSpace</span><span class="o">.</span><span class="n">_dask_client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">ChemSpace</span><span class="o">.</span><span class="n">_dask_cluster</span><span class="p">)</span> <span class="c1">#ChemSpace._dask_cluster, asynchronous=True)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dask can be watched on </span><span class="si">{</span><span class="n">ChemSpace</span><span class="o">.</span><span class="n">_dask_client</span><span class="o">.</span><span class="n">dashboard_link</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_scaffolds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_model</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_query</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_query_label</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="fegrow.package.ChemSpace.optimise_in_receptor" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">optimise_in_receptor</span>


<a href="#fegrow.package.ChemSpace.optimise_in_receptor" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">optimise_in_receptor</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Return lists of energies.</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">optimise_in_receptor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return lists of energies.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># daskify parameters</span>
    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">]</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># create the dask jobs</span>
    <span class="n">delayed_optimise_in_receptor</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">optimise_in_receptor</span><span class="p">)</span>
    <span class="n">jobs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">Mol</span><span class="o">.</span><span class="n">GetNumConformers</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Warning: mol </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> has no conformers. Ignoring receptor optimisation.&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">jobs</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">Mol</span><span class="p">]</span> <span class="o">=</span> <span class="n">delayed_optimise_in_receptor</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># dask batch compute</span>
    <span class="n">results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">jobs</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dask_client</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">jobs</span><span class="o">.</span><span class="n">values</span><span class="p">()))))</span>

    <span class="c1"># extract results</span>
    <span class="n">dfs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">mol</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">opt_mol</span><span class="p">,</span> <span class="n">energies</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">RemoveAllConformers</span><span class="p">()</span>
        <span class="c1"># replace the conformers with the optimised ones</span>
        <span class="p">[</span><span class="n">mol</span><span class="o">.</span><span class="n">AddConformer</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">opt_mol</span><span class="o">.</span><span class="n">GetConformers</span><span class="p">()]</span>

        <span class="n">mol</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="s2">&quot;energies&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">energies</span><span class="p">))</span>
        <span class="n">dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({}))</span>
        <span class="n">mol</span><span class="o">.</span><span class="n">_save_opt_energies</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.ChemSpace.discard_missing" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">discard_missing</span>


<a href="#fegrow.package.ChemSpace.discard_missing" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">discard_missing</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Remove from this list the molecules that have no conformers</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">discard_missing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove from this list the molecules that have no conformers</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ids_to_remove</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">Mol</span><span class="o">.</span><span class="n">GetNumConformers</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Discarding a molecule (id </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">) due to the lack of conformers. &quot;</span>
            <span class="p">)</span>
            <span class="n">ids_to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">ids_to_remove</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">ids_to_remove</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.ChemSpace.add_rgroups" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_rgroups</span>


<a href="#fegrow.package.ChemSpace.add_rgroups" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_rgroups</span><span class="p">(</span><span class="n">rgroups_linkers</span><span class="p">,</span> <span class="n">rgroups2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alltoall</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">



<details class="note-that-if-they-are-smiles" open>
  <summary>Note that if they are Smiles</summary>
  <ul>
<li>if they have an * atom (e.g. RDKit atom.SetAtomicNum(0)), this will be used for attachment to the scaffold</li>
<li>if they don't have an * atom, the scaffold will be fitted as a substructure</li>
</ul>
</details>        <p>First link the linker to the scaffold. Then add the rgroups.</p>
<p>:param rgroups2: A list of Smiles. Molecules will be accepted and converted to Smiles.
:param linker: A molecule. Ideally it has 2 atatchement points.
:return:</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_rgroups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rgroups_linkers</span><span class="p">,</span> <span class="n">rgroups2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alltoall</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Note that if they are Smiles:</span>
<span class="sd">     - if they have an * atom (e.g. RDKit atom.SetAtomicNum(0)), this will be used for attachment to the scaffold</span>
<span class="sd">     - if they don&#39;t have an * atom, the scaffold will be fitted as a substructure</span>

<span class="sd">    First link the linker to the scaffold. Then add the rgroups.</span>

<span class="sd">    :param rgroups2: A list of Smiles. Molecules will be accepted and converted to Smiles.</span>
<span class="sd">    :param linker: A molecule. Ideally it has 2 atatchement points.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">scaffold</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scaffolds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rgroups_linkers</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
        <span class="n">rgroups_linkers</span> <span class="o">=</span> <span class="p">[</span><span class="n">rgroups_linkers</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">rgroups2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rgroups2</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">Iterable</span><span class="p">):</span>
        <span class="n">rgroups2</span> <span class="o">=</span> <span class="p">[</span><span class="n">rgroups2</span><span class="p">]</span>

    <span class="c1"># create the dask jobs</span>
    <span class="n">delayed_build_molecule</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">build_molecule</span><span class="p">)</span>

    <span class="n">jobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">delayed_build_molecule</span><span class="p">(</span><span class="n">scaffold</span><span class="p">,</span> <span class="n">linker</span><span class="p">)</span> <span class="k">for</span> <span class="n">linker</span> <span class="ow">in</span> <span class="n">rgroups_linkers</span><span class="p">]</span>

    <span class="c1"># if linkers and rgroups are attached, add them in two iterations</span>
    <span class="k">if</span> <span class="n">rgroups2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">alltoall</span><span class="p">:</span>
        <span class="c1"># for each attached linker, attach an rgroup with the same position</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">delayed_build_molecule</span><span class="p">(</span><span class="n">scaffold_linked</span><span class="p">,</span> <span class="n">rgroup</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">rgroup</span><span class="p">,</span> <span class="n">scaffold_linked</span> <span class="ow">in</span>
                <span class="n">itertools</span><span class="o">.</span><span class="n">zip_longest</span><span class="p">(</span><span class="n">rgroups2</span><span class="p">,</span> <span class="n">jobs</span><span class="p">,</span> <span class="n">fillvalue</span><span class="o">=</span><span class="n">jobs</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
    <span class="k">elif</span> <span class="n">rgroups2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">alltoall</span><span class="p">:</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="p">[</span><span class="n">delayed_build_molecule</span><span class="p">(</span><span class="n">scaffold_linked</span><span class="p">,</span> <span class="n">rgroup</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">rgroup</span><span class="p">,</span> <span class="n">scaffold_linked</span> <span class="ow">in</span>
                <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">rgroups2</span><span class="p">,</span> <span class="n">jobs</span><span class="p">)]</span>

    <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dask_client</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>
    <span class="n">built_mols</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">results</span><span class="p">]</span>

    <span class="c1"># get Smiles</span>
    <span class="n">built_mols_smiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolToSmiles</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span> <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">built_mols</span><span class="p">]</span>

    <span class="c1"># extract the H indices used for attaching the scaffold</span>
    <span class="n">hs</span> <span class="o">=</span> <span class="p">[</span><span class="n">mol</span><span class="o">.</span><span class="n">GetIntProp</span><span class="p">(</span><span class="s1">&#39;attachment_point&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">built_mols</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">add_data</span><span class="p">({</span><span class="s2">&quot;Smiles&quot;</span><span class="p">:</span> <span class="n">built_mols_smiles</span><span class="p">,</span> <span class="s2">&quot;Mol&quot;</span><span class="p">:</span> <span class="n">built_mols</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span> <span class="n">hs</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.ChemSpace.add_data" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_data</span>


<a href="#fegrow.package.ChemSpace.add_data" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>:param data: dictionary {"Smiles": [], "h": [], ... }
:return:</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param data: dictionary {&quot;Smiles&quot;: [], &quot;h&quot;: [], ... }</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># ensure that the new indices start at the end</span>
    <span class="n">last_index</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">last_index</span><span class="p">):</span>
        <span class="n">last_index</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># ensure correct default values in the new rows</span>
    <span class="n">data_with_defaults</span> <span class="o">=</span> <span class="n">ChemSpace</span><span class="o">.</span><span class="n">DATAFRAME_DEFAULT_VALUES</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">data_with_defaults</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># update the internal dataframe</span>
    <span class="n">new_indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">last_index</span><span class="p">,</span> <span class="n">last_index</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">data_with_defaults</span><span class="p">[</span><span class="s1">&#39;Smiles&#39;</span><span class="p">]))</span>
    <span class="n">prepared_data</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data_with_defaults</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">new_indices</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">prepared_data</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">prepared_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.ChemSpace.add_smiles" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_smiles</span>


<a href="#fegrow.package.ChemSpace.add_smiles" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_smiles</span><span class="p">(</span><span class="n">smiles_list</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n"><span title="pandas.NA">NA</span></span><span class="p">,</span> <span class="n">protonate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add a list of Smiles into this ChemicalSpace</p>
<p>:param h: which h was used to connect to the
:param protonate: use openbabel to protonate each smile
:return:</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_smiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">smiles_list</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="n">pandas</span><span class="o">.</span><span class="n">NA</span><span class="p">,</span> <span class="n">protonate</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a list of Smiles into this ChemicalSpace</span>

<span class="sd">    :param h: which h was used to connect to the</span>
<span class="sd">    :param protonate: use openbabel to protonate each smile</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">protonate</span><span class="p">:</span>
        <span class="n">delayed_protonations</span> <span class="o">=</span> <span class="p">[</span><span class="n">DaskTasks</span><span class="o">.</span><span class="n">obabel_protonate</span><span class="p">(</span><span class="n">smi</span><span class="p">)</span> <span class="k">for</span> <span class="n">smi</span> <span class="ow">in</span> <span class="n">smiles_list</span><span class="p">]</span>
        <span class="n">jobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dask_client</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="n">delayed_protonations</span><span class="p">)</span>
        <span class="n">smiles_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">]</span>

    <span class="c1"># convert the Smiles into molecules</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SmilesParserParams</span><span class="p">()</span>
    <span class="n">params</span><span class="o">.</span><span class="n">removeHs</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">mols</span> <span class="o">=</span> <span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">smiles</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span> <span class="k">for</span> <span class="n">smiles</span> <span class="ow">in</span> <span class="n">smiles_list</span><span class="p">]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">add_data</span><span class="p">({</span><span class="s2">&quot;Smiles&quot;</span><span class="p">:</span> <span class="n">smiles_list</span><span class="p">,</span> <span class="s2">&quot;Mol&quot;</span><span class="p">:</span> <span class="n">mols</span><span class="p">,</span> <span class="s2">&quot;h&quot;</span><span class="p">:</span><span class="n">h</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.ChemSpace._evaluate_experimental" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">_evaluate_experimental</span>


<a href="#fegrow.package.ChemSpace._evaluate_experimental" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">_evaluate_experimental</span><span class="p">(</span><span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_conf</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">minimum_conf_rms</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">min_dst_allowed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate the conformers and score the subset of molecules.</p>
<p>E.g.
:param indices: The indices in the dataframe to be run through the pipeline.
    If None, all molecules are evaluated.
:return:</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_experimental</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_conf</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">minimum_conf_rms</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">min_dst_allowed</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate the conformers and score the subset of molecules.</span>

<span class="sd">    E.g.</span>
<span class="sd">    :param indices: The indices in the dataframe to be run through the pipeline.</span>
<span class="sd">        If None, all molecules are evaluated.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># evaluate all molecules</span>
        <span class="n">rgroups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">Mol</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scaffolds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please add scaffolds to the system for the evaluation. &quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scaffolds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;For now we only allow working with one scaffold. &quot;</span><span class="p">)</span>

    <span class="c1"># carry out the full pipeline, generate conformers, etc.</span>
    <span class="c1"># note that we have to find a way to pass all the molecules</span>
    <span class="c1"># this means creating a pipeline of tasks for Dask,</span>
    <span class="c1"># a pipeline that is well conditional</span>

    <span class="c1">## GENERATE CONFORMERS</span>
    <span class="n">num_conf</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">num_conf</span><span class="p">)</span>
    <span class="n">minimum_conf_rms</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">minimum_conf_rms</span><span class="p">)</span>
    <span class="n">protein</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">prody_package</span><span class="o">.</span><span class="n">parsePDB</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_protein_filename</span><span class="p">))</span>
    <span class="n">protein_file</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_protein_filename</span><span class="p">)</span>
    <span class="n">min_dst_allowed</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">min_dst_allowed</span><span class="p">)</span>
    <span class="n">RMol</span><span class="o">.</span><span class="n">_check_download_gnina</span><span class="p">()</span>
    <span class="n">gnina_path</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RMol</span><span class="o">.</span><span class="n">gnina_dir</span><span class="p">,</span> <span class="s1">&#39;gnina&#39;</span><span class="p">))</span>

    <span class="c1"># functions</span>
    <span class="n">delayed_generate_conformers</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">generate_conformers</span><span class="p">)</span>
    <span class="n">delayed_remove_clashing_confs</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">RMol</span><span class="o">.</span><span class="n">remove_clashing_confs</span><span class="p">)</span>
    <span class="n">delayed_gnina</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">gnina</span><span class="p">)</span>

    <span class="c1"># create dask jobs</span>
    <span class="n">jobs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">generated_confs</span> <span class="o">=</span> <span class="n">delayed_generate_conformers</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="n">num_conf</span><span class="p">,</span> <span class="n">minimum_conf_rms</span><span class="p">)</span>
        <span class="n">removed_clashes</span> <span class="o">=</span> <span class="n">delayed_remove_clashing_confs</span><span class="p">(</span><span class="n">generated_confs</span><span class="p">,</span> <span class="n">protein</span><span class="p">,</span>
                                                                             <span class="n">min_dst_allowed</span><span class="o">=</span><span class="n">min_dst_allowed</span><span class="p">)</span>
        <span class="n">jobs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">delayed_gnina</span><span class="p">(</span><span class="n">removed_clashes</span><span class="p">,</span> <span class="n">protein_file</span><span class="p">,</span> <span class="n">gnina_path</span><span class="p">)</span>

    <span class="c1"># run all jobs</span>
    <span class="n">results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">jobs</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dask_client</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">jobs</span><span class="o">.</span><span class="n">values</span><span class="p">()))))</span>

    <span class="c1"># gather the results</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">mol</span><span class="p">,</span> <span class="n">cnnaffinities</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

        <span class="c1"># extract the conformers</span>
        <span class="n">input_mol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">Mol</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">input_mol</span><span class="o">.</span><span class="n">RemoveAllConformers</span><span class="p">()</span>
        <span class="p">[</span><span class="n">input_mol</span><span class="o">.</span><span class="n">AddConformer</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">mol</span><span class="o">.</span><span class="n">GetConformers</span><span class="p">()]</span>

        <span class="c1"># save the affinities so that one can retrace which conformer has the best energy</span>
        <span class="n">input_mol</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="s2">&quot;cnnaffinities&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cnnaffinities</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">score</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cnnaffinities</span><span class="p">)</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evaluated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> cases&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.ChemSpace.evaluate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">evaluate</span>


<a href="#fegrow.package.ChemSpace.evaluate" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">evaluate</span><span class="p">(</span><span class="n">indices</span><span class="p">:</span> <span class="n"><span title="typing.Union">Union</span></span><span class="p">[</span><span class="n"><span title="typing.Sequence">Sequence</span></span><span class="p">[</span><span class="n"><span title="int">int</span></span><span class="p">],</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">scoring_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gnina_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gnina_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_conf</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">minimum_conf_rms</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">penalty</span><span class="o">=</span><span class="n"><span title="pandas.NA">NA</span></span><span class="p">,</span> <span class="n">al_ignore_penalty</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>:param indices:
:param scoring_function:
:param gnina_path:
:param gnina_gpu:
:param num_conf:
:param minimum_conf_rms:
:param penalty:
:param al_ignore_penalty:
:param kwargs:
:return:</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">indices</span> <span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">scoring_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">gnina_path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">gnina_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">num_conf</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
             <span class="n">minimum_conf_rms</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
             <span class="n">penalty</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">NA</span><span class="p">,</span>
             <span class="n">al_ignore_penalty</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param indices:</span>
<span class="sd">    :param scoring_function:</span>
<span class="sd">    :param gnina_path:</span>
<span class="sd">    :param gnina_gpu:</span>
<span class="sd">    :param num_conf:</span>
<span class="sd">    :param minimum_conf_rms:</span>
<span class="sd">    :param penalty:</span>
<span class="sd">    :param al_ignore_penalty:</span>
<span class="sd">    :param kwargs:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># evaluate all molecules if no indices are picked</span>
    <span class="k">if</span> <span class="n">indices</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Please provide at least 3 items&quot;</span><span class="p">)</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">index</span>

    <span class="n">selected_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>

    <span class="c1"># discard computed rows</span>
    <span class="n">selected_rows</span> <span class="o">=</span> <span class="n">selected_rows</span><span class="p">[</span><span class="n">selected_rows</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scaffolds</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please add scaffolds to the system for the evaluation. &quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scaffolds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;For now we only allow working with one scaffold. &quot;</span><span class="p">)</span>

    <span class="c1"># should be enough to do it once, shared</span>
    <span class="c1">## GENERATE CONFORMERS</span>

    <span class="k">if</span> <span class="n">gnina_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># gnina_path = delayed(os.path.join(RMol.gnina_dir, &#39;gnina&#39;))</span>
        <span class="n">RMol</span><span class="o">.</span><span class="n">set_gnina</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RMol</span><span class="o">.</span><span class="n">gnina_dir</span><span class="p">,</span> <span class="s1">&#39;gnina&#39;</span><span class="p">))</span>
    <span class="n">RMol</span><span class="o">.</span><span class="n">_check_download_gnina</span><span class="p">()</span>

    <span class="n">num_conf</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">num_conf</span><span class="p">)</span>
    <span class="n">minimum_conf_rms</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">minimum_conf_rms</span><span class="p">)</span>
    <span class="n">protein_file</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_protein_filename</span><span class="p">)</span>
    <span class="n">RMol</span><span class="o">.</span><span class="n">_check_download_gnina</span><span class="p">()</span>

    <span class="n">scaffold</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scaffolds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1"># extract which hydrogen was used for the attachement</span>
    <span class="n">h_attachements</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scaffolds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">()</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">GetAtomicNum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>

    <span class="n">h_attachement_index</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">h_attachements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">h_attachement_index</span> <span class="o">=</span> <span class="n">h_attachements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># create dask jobs</span>
    <span class="n">delayed_evaluate</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">_evaluate_atomic</span><span class="p">)</span>
    <span class="n">jobs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">selected_rows</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">jobs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">delayed_evaluate</span><span class="p">(</span><span class="n">scaffold</span><span class="p">,</span>
                                    <span class="n">row</span><span class="o">.</span><span class="n">Smiles</span><span class="p">,</span>
                                    <span class="n">protein_file</span><span class="p">,</span>
                                    <span class="n">h</span><span class="o">=</span><span class="n">h_attachement_index</span><span class="p">,</span>
                                    <span class="n">num_conf</span><span class="o">=</span><span class="n">num_conf</span><span class="p">,</span>
                                    <span class="n">minimum_conf_rms</span><span class="o">=</span><span class="n">minimum_conf_rms</span><span class="p">,</span>
                                    <span class="n">scoring_function</span><span class="o">=</span><span class="n">scoring_function</span><span class="p">,</span>
                                    <span class="n">gnina_gpu</span><span class="o">=</span><span class="n">gnina_gpu</span><span class="p">,</span>
                                    <span class="o">**</span><span class="n">kwargs</span>
                                    <span class="p">)</span>

    <span class="c1"># run all</span>
    <span class="n">results</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">jobs</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">dask_client</span><span class="o">.</span><span class="n">compute</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">jobs</span><span class="o">.</span><span class="n">values</span><span class="p">()))))</span>

    <span class="c1"># gather the results</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">Training</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">build_succeeded</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">mol</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

            <span class="c1"># save all data generated</span>
            <span class="k">if</span> <span class="n">mol</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">mol</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

                <span class="c1"># replace the original molecule with the new one</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot;Mol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mol</span>

            <span class="c1"># extract the score</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">E</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed Process&quot;</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">cmd</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">output</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">penalty</span>
            <span class="n">build_succeeded</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">al_ignore_penalty</span><span class="p">:</span>
                <span class="n">Training</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">E</span><span class="p">:</span>
            <span class="c1"># failed to finish the protocol, set the penalty</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">penalty</span>
            <span class="n">build_succeeded</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">al_ignore_penalty</span><span class="p">:</span>
                <span class="n">Training</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">,</span> <span class="s2">&quot;Training&quot;</span><span class="p">,</span> <span class="s2">&quot;Success&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">score</span><span class="p">,</span> <span class="n">Training</span><span class="p">,</span> <span class="n">build_succeeded</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Evaluated </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> cases&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.ChemSpace.add_enamine_molecules" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">add_enamine_molecules</span>


<a href="#fegrow.package.ChemSpace.add_enamine_molecules" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_enamine_molecules</span><span class="p">(</span><span class="n">n_best</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">results_per_search</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">remove_scaffold_h</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>For the best scoring molecules, find similar molecules in Enamine REAL database
 and add them to the dataset.</p>
<p>Make sure you have the permission/license to use https://sw.docking.org/search.html
    this way.</p>
<p>@scaffold: The scaffold molecule that has to be present in the found molecules.
    If None, this requirement will be ignored.
@molecules_per_smile: How many top results (molecules) per Smiles searched.</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_enamine_molecules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_best</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">results_per_search</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">remove_scaffold_h</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    For the best scoring molecules, find similar molecules in Enamine REAL database</span>
<span class="sd">     and add them to the dataset.</span>

<span class="sd">    Make sure you have the permission/license to use https://sw.docking.org/search.html</span>
<span class="sd">        this way.</span>

<span class="sd">    @scaffold: The scaffold molecule that has to be present in the found molecules.</span>
<span class="sd">        If None, this requirement will be ignored.</span>
<span class="sd">    @molecules_per_smile: How many top results (molecules) per Smiles searched.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">from</span><span class="w"> </span><span class="nn">pydockingorg</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enamine</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scaffolds</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Only one scaffold is supported atm.&quot;</span><span class="p">)</span>

    <span class="n">scaffold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scaffolds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># get the best performing molecules</span>
    <span class="n">vl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;score&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">best_vl_for_searching</span> <span class="o">=</span> <span class="n">vl</span><span class="p">[:</span><span class="n">n_best</span><span class="p">]</span>

    <span class="c1"># nothing to search for yet</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">best_vl_for_searching</span><span class="p">[</span><span class="o">~</span><span class="n">best_vl_for_searching</span><span class="o">.</span><span class="n">score</span><span class="o">.</span><span class="n">isna</span><span class="p">()])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">best_vl_for_searching</span><span class="o">.</span><span class="n">h</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Multiple growth vectors are used. &#39;</span><span class="p">)</span>

    <span class="c1"># filter out previously queried molecules</span>
    <span class="n">new_searches</span> <span class="o">=</span> <span class="n">best_vl_for_searching</span><span class="p">[</span><span class="n">best_vl_for_searching</span><span class="o">.</span><span class="n">enamine_searched</span> <span class="o">==</span> <span class="kc">False</span><span class="p">]</span>
    <span class="n">smiles_to_search</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">new_searches</span><span class="o">.</span><span class="n">Smiles</span><span class="p">)</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Querying Enamine REAL. Looking up </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">smiles_to_search</span><span class="p">)</span><span class="si">}</span><span class="s1"> smiles.&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">Enamine</span><span class="p">()</span> <span class="k">as</span> <span class="n">DB</span><span class="p">:</span>
            <span class="n">results</span><span class="p">:</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="n">DB</span><span class="o">.</span><span class="n">search_smiles</span><span class="p">(</span><span class="n">smiles_to_search</span><span class="p">,</span> <span class="n">remove_duplicates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                                         <span class="n">results_per_search</span><span class="o">=</span><span class="n">results_per_search</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">HTTPError</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Enamine API call failed. &quot;</span><span class="p">,</span> <span class="n">HTTPError</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Enamine returned with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows in </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">s.&quot;</span><span class="p">)</span>

    <span class="c1"># update the database that this molecule has been searched</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_searches</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;enamine_searched&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The server did not return a single Smiles!&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># prepare the scaffold for testing its presence</span>
    <span class="c1"># specifically, the hydrogen was replaced and has to be removed</span>
    <span class="c1"># for now we assume we only are growing one vector at a time - fixme</span>
    <span class="k">if</span> <span class="n">remove_scaffold_h</span><span class="p">:</span>
        <span class="n">scaffold_noh</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">EditableMol</span><span class="p">(</span><span class="n">scaffold</span><span class="p">)</span>
        <span class="n">scaffold_noh</span><span class="o">.</span><span class="n">RemoveAtom</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">best_vl_for_searching</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">h</span><span class="p">))</span>
        <span class="n">scaffold</span> <span class="o">=</span> <span class="n">scaffold_noh</span><span class="o">.</span><span class="n">GetMol</span><span class="p">()</span>

    <span class="n">dask_scaffold</span> <span class="o">=</span> <span class="n">dask</span><span class="o">.</span><span class="n">delayed</span><span class="p">(</span><span class="n">scaffold</span><span class="p">)</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="c1"># protonate and check for scaffold</span>
    <span class="n">delayed_protonations</span> <span class="o">=</span> <span class="p">[</span><span class="n">DaskTasks</span><span class="o">.</span><span class="n">obabel_protonate</span><span class="p">(</span><span class="n">smi</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="k">for</span> <span class="n">smi</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">hitSmiles</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
    <span class="n">jobs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dask_client</span><span class="o">.</span><span class="n">compute</span><span class="p">([</span><span class="n">DaskTasks</span><span class="o">.</span><span class="n">scaffold_check</span><span class="p">(</span><span class="n">smih</span><span class="p">,</span> <span class="n">dask_scaffold</span><span class="p">)</span>
                                     <span class="k">for</span> <span class="n">smih</span> <span class="ow">in</span> <span class="n">delayed_protonations</span><span class="p">])</span>
    <span class="n">scaffold_test_results</span> <span class="o">=</span> <span class="p">[</span><span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">jobs</span><span class="p">]</span>
    <span class="n">scaffold_mask</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">scaffold_test_results</span><span class="p">]</span>
    <span class="c1"># smiles None means that the molecule did not have our scaffold</span>
    <span class="n">protonated_smiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">scaffold_test_results</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Dask obabel protonation + scaffold test finished in </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">s.&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Tested scaffold presence. Kept </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">scaffold_mask</span><span class="p">)</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">scaffold_mask</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scaffold_mask</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">similar</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">scaffold_mask</span><span class="p">]</span>
        <span class="n">similar</span><span class="o">.</span><span class="n">hitSmiles</span> <span class="o">=</span> <span class="n">protonated_smiles</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">similar</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">results</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

    <span class="c1"># filter out Enamine molecules which were previously added</span>
    <span class="n">new_enamines</span> <span class="o">=</span> <span class="n">similar</span><span class="p">[</span><span class="o">~</span><span class="n">similar</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">vl</span><span class="o">.</span><span class="n">enamine_id</span><span class="p">)]</span>

    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Only one H vector is assumed and used. Picking </span><span class="si">{</span><span class="n">vl</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> hydrogen on the scaffold. &quot;</span><span class="p">)</span>
    <span class="n">new_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Smiles&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">new_enamines</span><span class="o">.</span><span class="n">hitSmiles</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
        <span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="n">vl</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="c1"># fixme: for now assume that only one vector is used</span>
        <span class="s1">&#39;enamine_id&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">new_enamines</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adding: &quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_enamines</span><span class="o">.</span><span class="n">hitSmiles</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.ChemSpace.active_learning" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">active_learning</span>


<a href="#fegrow.package.ChemSpace.active_learning" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">active_learning</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">first_random</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">score_higher_better</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">learner_type</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Model the data using the Training subset. Then use the active learning query method.</p>
<p>See properties "model" and "query" for finer control.</p>
<p>It's better to save the FPs in the dataframe. Or in the underlying system.
:return:</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">active_learning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">first_random</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">score_higher_better</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">learner_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model the data using the Training subset. Then use the active learning query method.</span>

<span class="sd">    See properties &quot;model&quot; and &quot;query&quot; for finer control.</span>

<span class="sd">    It&#39;s better to save the FPs in the dataframe. Or in the underlying system.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">training</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">Training</span><span class="p">]</span>
    <span class="n">selection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">Training</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">training</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">first_random</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Selecting randomly the first samples to be studied (no score data yet). &quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">selection</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;There is no scores for active learning. Please use the </span><span class="se">\&quot;</span><span class="s2">first_random</span><span class="se">\&quot;</span><span class="s2"> property. &quot;</span><span class="p">)</span>

    <span class="c1"># get the scored subset</span>
    <span class="c1"># fixme - multitarget?</span>
    <span class="n">train_targets</span> <span class="o">=</span> <span class="n">training</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="n">library_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_fps</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">Smiles</span><span class="p">))</span>
    <span class="n">train_features</span> <span class="o">=</span> <span class="n">library_features</span><span class="p">[</span><span class="n">training</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
    <span class="n">selection_features</span> <span class="o">=</span> <span class="n">library_features</span><span class="p">[</span><span class="n">selection</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">fegrow.al</span>

    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">fegrow</span><span class="o">.</span><span class="n">al</span><span class="o">.</span><span class="n">Model</span><span class="o">.</span><span class="n">gaussian_process</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">query</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">query</span>

    <span class="c1"># employ Greedy query by default</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">fegrow</span><span class="o">.</span><span class="n">al</span><span class="o">.</span><span class="n">Query</span><span class="o">.</span><span class="n">Greedy</span><span class="p">()</span>

    <span class="c1"># update on how many to querry</span>
    <span class="n">query</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="n">n_instances</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="n">target_multiplier</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">score_higher_better</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">target_multiplier</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_label</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;greedy&#39;</span><span class="p">,</span> <span class="s1">&#39;thompson&#39;</span><span class="p">,</span> <span class="s1">&#39;EI&#39;</span><span class="p">,</span> <span class="s1">&#39;PI&#39;</span><span class="p">]:</span>
        <span class="n">target_multiplier</span> <span class="o">*=</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_label</span> <span class="o">==</span> <span class="s1">&#39;UCB&#39;</span><span class="p">:</span>
        <span class="n">target_multiplier</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">train_targets</span> <span class="o">=</span> <span class="n">train_targets</span> <span class="o">*</span> <span class="n">target_multiplier</span>

    <span class="c1"># only GP uses Bayesian Optimizer</span>
    <span class="k">if</span> <span class="n">learner_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">learner</span> <span class="o">=</span> <span class="n">learner_type</span><span class="p">(</span>
            <span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="n">X_training</span><span class="o">=</span><span class="n">train_features</span><span class="p">,</span>
            <span class="n">y_training</span><span class="o">=</span><span class="n">train_targets</span><span class="p">,</span>
            <span class="n">query_strategy</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">gaussian_process</span><span class="o">.</span><span class="n">GaussianProcessRegressor</span><span class="p">):</span>
        <span class="n">learner</span> <span class="o">=</span> <span class="n">modAL</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">BayesianOptimizer</span><span class="p">(</span>
            <span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="n">X_training</span><span class="o">=</span><span class="n">train_features</span><span class="p">,</span>
            <span class="n">y_training</span><span class="o">=</span><span class="n">train_targets</span><span class="p">,</span>
            <span class="n">query_strategy</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">learner</span> <span class="o">=</span> <span class="n">modAL</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">ActiveLearner</span><span class="p">(</span>
            <span class="n">estimator</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="n">X_training</span><span class="o">=</span><span class="n">train_features</span><span class="p">,</span>
            <span class="n">y_training</span><span class="o">=</span><span class="n">train_targets</span><span class="p">,</span>
            <span class="n">query_strategy</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>

    <span class="n">inference</span> <span class="o">=</span> <span class="n">learner</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">library_features</span><span class="p">)</span> <span class="o">*</span> <span class="n">target_multiplier</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;regression&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">inference</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="n">selection_idx</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">learner</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">selection_features</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">selection</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">selection_idx</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.ChemSpace.compute_fps" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">compute_fps</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-cached"><code>cached</code></small>
  </span>

<a href="#fegrow.package.ChemSpace.compute_fps" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">compute_fps</span><span class="p">(</span><span class="n">smiles_tuple</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>:param smiles_tuple: It has to be a tuple to be hashable (to work with caching).
:return:</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@functools</span><span class="o">.</span><span class="n">cache</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_fps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">smiles_tuple</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param smiles_tuple: It has to be a tuple to be hashable (to work with caching).</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">futures</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dask_client</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">ChemSpace</span><span class="o">.</span><span class="n">_compute_fp_from_smiles</span><span class="p">,</span> <span class="n">smiles_tuple</span><span class="p">)</span>
    <span class="n">fps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">futures</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">fps</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="fegrow.package.ChemSpace.to_sdf" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">to_sdf</span>


<a href="#fegrow.package.ChemSpace.to_sdf" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">to_sdf</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">failed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unbuilt</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Write every molecule and all its fields as properties, to an SDF file.</p>
<p>:return:</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_sdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">failed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unbuilt</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Write every molecule and all its fields as properties, to an SDF file.</span>

<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SDWriter</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">SD</span><span class="p">:</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="n">columns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Mol&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>

            <span class="c1"># ignore this molecule because it failed during the build</span>
            <span class="k">if</span> <span class="n">failed</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">row</span><span class="o">.</span><span class="n">Success</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># ignore this molecule because it was not built yet</span>
            <span class="k">if</span> <span class="n">unbuilt</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">row</span><span class="o">.</span><span class="n">Success</span> <span class="ow">is</span> <span class="n">pandas</span><span class="o">.</span><span class="n">NA</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">mol</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">Mol</span>
            <span class="n">mol</span><span class="o">.</span><span class="n">SetIntProp</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
                <span class="n">mol</span><span class="o">.</span><span class="n">SetProp</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

            <span class="n">mol</span><span class="o">.</span><span class="n">ClearProp</span><span class="p">(</span><span class="s2">&quot;attachement_point&quot;</span><span class="p">)</span>
            <span class="n">SD</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fegrow.package.RGroups" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">RGroups</span>


<a href="#fegrow.package.RGroups" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">RGroups</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pandas.DataFrame">DataFrame</span></code></p>


        <p>The default R-Group library with visualisation (mols2grid).</p>










                  <details class="quote">
                    <summary>Source code in <code>fegrow/package.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">RGroups</span><span class="o">.</span><span class="n">_load_data</span><span class="p">()</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_fegrow_grid</span> <span class="o">=</span> <span class="n">mols2grid</span><span class="o">.</span><span class="n">MolGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">removeHs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mol_col</span><span class="o">=</span><span class="s2">&quot;Mol&quot;</span><span class="p">,</span> <span class="n">use_coords</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;m2&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="fegrow.package.RGroups._load_data" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>            <span class="doc doc-object-name doc-function-name">_load_data</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#fegrow.package.RGroups._load_data" class="headerlink" title="Permanent link">#</a></h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">_load_data</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="pandas.DataFrame">DataFrame</span></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Load the default R-Group library</p>
<p>The R-groups were largely extracted from (please cite accordingly):
Takeuchi, Kosuke, Ryo Kunimoto, and Jürgen Bajorath. "R-group replacement database for medicinal chemistry." Future Science OA 7.8 (2021): FSO742.</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_load_data</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load the default R-Group library</span>

<span class="sd">    The R-groups were largely extracted from (please cite accordingly):</span>
<span class="sd">    Takeuchi, Kosuke, Ryo Kunimoto, and Jürgen Bajorath. &quot;R-group replacement database for medicinal chemistry.&quot; Future Science OA 7.8 (2021): FSO742.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">molecules</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">builtin_rgroups</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">&quot;data&quot;</span> <span class="o">/</span> <span class="s2">&quot;rgroups&quot;</span> <span class="o">/</span> <span class="s2">&quot;library.sdf&quot;</span>
    <span class="k">for</span> <span class="n">rgroup</span> <span class="ow">in</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SDMolSupplier</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">builtin_rgroups</span><span class="p">),</span> <span class="n">removeHs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">molecules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgroup</span><span class="p">)</span>
        <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgroup</span><span class="o">.</span><span class="n">GetProp</span><span class="p">(</span><span class="s2">&quot;SMILES&quot;</span><span class="p">))</span>

        <span class="c1"># highlight the attachment atom</span>
        <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">rgroup</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">atom</span><span class="o">.</span><span class="n">GetAtomicNum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">rgroup</span><span class="p">,</span> <span class="s2">&quot;__sssAtoms&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">atom</span><span class="o">.</span><span class="n">GetIdx</span><span class="p">()])</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;Mol&quot;</span><span class="p">:</span> <span class="n">molecules</span><span class="p">,</span> <span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="n">names</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="fegrow.package.Linkers" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <span class="doc doc-object-name doc-class-name">Linkers</span>


<a href="#fegrow.package.Linkers" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">Linkers</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pandas.DataFrame">DataFrame</span></code></p>


        <p>A linker library presented as a grid molecules using mols2grid library.</p>










                  <details class="quote">
                    <summary>Source code in <code>fegrow/package.py</code></summary>
                    <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># initialise self dataframe</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Linkers</span><span class="o">.</span><span class="n">_load_data</span><span class="p">()</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_fegrow_grid</span> <span class="o">=</span> <span class="n">mols2grid</span><span class="o">.</span><span class="n">MolGrid</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">removeHs</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">mol_col</span><span class="o">=</span><span class="s2">&quot;Mol&quot;</span><span class="p">,</span>
        <span class="n">use_coords</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;m1&quot;</span><span class="p">,</span>
        <span class="n">prerender</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
                  </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="fegrow.package.build_molecule" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">build_molecule</span>


<a href="#fegrow.package.build_molecule" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">build_molecule</span><span class="p">(</span><span class="n">scaffolds</span><span class="p">:</span> <span class="n"><span title="rdkit.Chem.Mol">Mol</span></span><span class="p">,</span> <span class="n">r_group</span><span class="p">:</span> <span class="n"><span title="typing.Union">Union</span></span><span class="p">[</span><span class="n"><span title="rdkit.Chem.Mol">Mol</span></span><span class="p">,</span> <span class="n"><span title="str">str</span></span><span class="p">],</span> <span class="n">scaffold_point</span><span class="p">:</span> <span class="n"><span title="typing.Optional">Optional</span></span><span class="p">[</span><span class="n"><span title="int">int</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">rgroup_point</span><span class="p">:</span> <span class="n"><span title="typing.Optional">Optional</span></span><span class="p">[</span><span class="n"><span title="int">int</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">keep</span><span class="p">:</span> <span class="n"><span title="typing.Optional">Optional</span></span><span class="p">[</span><span class="n"><span title="int">int</span></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>:param scaffolds:
:param r_groups:
:param scaffold_point: attachement point on the scaffold
:param keep: When the scaffold is grown from an internal atom that divides the molecules into separate
    submolecules, keep the submolecule with this atom index.
:return:</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_molecule</span><span class="p">(</span>
    <span class="n">scaffolds</span><span class="p">:</span> <span class="n">Chem</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span>
    <span class="n">r_group</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Chem</span><span class="o">.</span><span class="n">Mol</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
    <span class="n">scaffold_point</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">rgroup_point</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">keep</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param scaffolds:</span>
<span class="sd">    :param r_groups:</span>
<span class="sd">    :param scaffold_point: attachement point on the scaffold</span>
<span class="sd">    :param keep: When the scaffold is grown from an internal atom that divides the molecules into separate</span>
<span class="sd">        submolecules, keep the submolecule with this atom index.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r_group</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_group</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Empty list received. Please pass any R-groups or R-linkers. &quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scaffold_point</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scaffolds</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only one scaffold and rgroup at at time is permitted. &quot;</span><span class="p">)</span>

    <span class="c1"># scaffolds were created earlier, they are most likely templates combined with linkers,</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scaffolds</span><span class="p">,</span> <span class="n">ChemSpace</span><span class="p">):</span>
        <span class="c1"># fixme - these should become &quot;the cores&quot;, it&#39;s simple with one mol, and tricky with more of them,</span>
        <span class="n">scaffolds</span> <span class="o">=</span> <span class="p">[</span><span class="n">mol</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">mol</span> <span class="ow">in</span> <span class="n">scaffolds</span><span class="o">.</span><span class="n">dataframe</span><span class="o">.</span><span class="n">Mol</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

    <span class="c1"># convert smiles into a molecule</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r_group</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;*&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">r_group</span> <span class="ow">and</span> <span class="n">rgroup_point</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The SMILES used for the R-Group has to have an R-group atom. &quot;</span>
                             <span class="s2">&quot;That is the character * in Smiles, or you can use the RDKit function .SetAtomicNum(0) &quot;</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SmilesParserParams</span><span class="p">()</span>
        <span class="n">params</span><span class="o">.</span><span class="n">removeHs</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">r_group</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">r_group</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>

        <span class="c1"># set the attachement point on the R-group</span>
        <span class="k">if</span> <span class="n">rgroup_point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">r_group</span><span class="o">.</span><span class="n">GetAtomWithIdx</span><span class="p">(</span><span class="n">rgroup_point</span><span class="p">)</span><span class="o">.</span><span class="n">SetAtomicNum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">built_mols</span> <span class="o">=</span> <span class="n">build_molecules_with_rdkit</span><span class="p">(</span>
        <span class="n">scaffolds</span><span class="p">,</span> <span class="n">r_group</span><span class="p">,</span> <span class="n">scaffold_point</span><span class="p">,</span> <span class="n">keep</span>
    <span class="p">)</span>

    <span class="n">mol</span><span class="p">,</span> <span class="n">scaffold</span><span class="p">,</span> <span class="n">scaffold_no_attachement</span> <span class="o">=</span> <span class="n">built_mols</span>
    <span class="n">rmol</span> <span class="o">=</span> <span class="n">RMol</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">scaffold</span><span class="p">,</span> <span class="s1">&#39;template&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scaffold</span><span class="o">.</span><span class="n">template</span><span class="p">,</span> <span class="n">rdkit</span><span class="o">.</span><span class="n">Chem</span><span class="o">.</span><span class="n">Mol</span><span class="p">):</span>
        <span class="c1"># save the original scaffold (e.g. before the linker was added)</span>
        <span class="c1"># this means that conformer generation will always have to regenerate the previously added R-groups/linkers</span>
        <span class="n">rmol</span><span class="o">.</span><span class="n">_save_template</span><span class="p">(</span><span class="n">scaffold</span><span class="o">.</span><span class="n">template</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rmol</span><span class="o">.</span><span class="n">_save_template</span><span class="p">(</span><span class="n">scaffold_no_attachement</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">rmol</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="fegrow.package._evaluate_atomic" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">_evaluate_atomic</span>


<a href="#fegrow.package._evaluate_atomic" class="headerlink" title="Permanent link">#</a></h2>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">_evaluate_atomic</span><span class="p">(</span><span class="n">scaffold</span><span class="p">,</span> <span class="n">smiles</span><span class="p">,</span> <span class="n">pdb_filename</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scoring_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_conf</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">minimum_conf_rms</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ani</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">platform</span><span class="o">=</span><span class="s1">&#39;CPU&#39;</span><span class="p">,</span> <span class="n">gnina_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">skip_optimisation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">full_evaluation</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>:param scaffold:
:param h:
:param smiles: Full Smiles.
:param scoring_function:
:param pdb_filename:
:param gnina_path:
:return:</p>

            <details class="quote">
              <summary>Source code in <code>fegrow/package.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_atomic</span><span class="p">(</span><span class="n">scaffold</span><span class="p">,</span>
                     <span class="n">smiles</span><span class="p">,</span>
                     <span class="n">pdb_filename</span><span class="p">,</span>
                     <span class="n">h</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">scoring_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">num_conf</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                     <span class="n">minimum_conf_rms</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                     <span class="n">ani</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">platform</span><span class="o">=</span><span class="s2">&quot;CPU&quot;</span><span class="p">,</span>
                     <span class="n">gnina_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">skip_optimisation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                     <span class="n">full_evaluation</span><span class="o">=</span><span class="kc">None</span>
                     <span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param scaffold:</span>
<span class="sd">    :param h:</span>
<span class="sd">    :param smiles: Full Smiles.</span>
<span class="sd">    :param scoring_function:</span>
<span class="sd">    :param pdb_filename:</span>
<span class="sd">    :param gnina_path:</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">full_evaluation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">full_evaluation</span><span class="p">(</span><span class="n">scaffold</span><span class="p">,</span>
                     <span class="n">h</span><span class="p">,</span>
                     <span class="n">smiles</span><span class="p">,</span>
                     <span class="n">pdb_filename</span><span class="p">,</span>
                     <span class="n">scoring_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">num_conf</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                     <span class="n">minimum_conf_rms</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                     <span class="n">ani</span><span class="o">=</span><span class="n">ani</span><span class="p">,</span>
                     <span class="n">platform</span><span class="o">=</span><span class="s2">&quot;CPU&quot;</span><span class="p">,</span>
                     <span class="n">skip_optimisation</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">params</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">SmilesParserParams</span><span class="p">()</span>
    <span class="n">params</span><span class="o">.</span><span class="n">removeHs</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># keep the hydrogens</span>
    <span class="n">rmol</span> <span class="o">=</span> <span class="n">RMol</span><span class="p">(</span><span class="n">Chem</span><span class="o">.</span><span class="n">MolFromSmiles</span><span class="p">(</span><span class="n">smiles</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">))</span>

    <span class="c1"># remove the h</span>
    <span class="c1"># this is to help the rdkit&#39;s HasSubstructMatch</span>
    <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scaffold</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">scaffold</span><span class="p">)</span>
        <span class="n">scaffold_m</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">EditableMol</span><span class="p">(</span><span class="n">scaffold</span><span class="p">)</span>
        <span class="n">scaffold_m</span><span class="o">.</span><span class="n">RemoveAtom</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">))</span>
        <span class="n">scaffold</span> <span class="o">=</span> <span class="n">scaffold_m</span><span class="o">.</span><span class="n">GetMol</span><span class="p">()</span>

    <span class="n">rmol</span><span class="o">.</span><span class="n">_save_template</span><span class="p">(</span><span class="n">scaffold</span><span class="p">)</span>

    <span class="n">rmol</span><span class="o">.</span><span class="n">generate_conformers</span><span class="p">(</span><span class="n">num_conf</span><span class="o">=</span><span class="n">num_conf</span><span class="p">,</span> <span class="n">minimum_conf_rms</span><span class="o">=</span><span class="n">minimum_conf_rms</span><span class="p">)</span>
    <span class="n">rmol</span><span class="o">.</span><span class="n">remove_clashing_confs</span><span class="p">(</span><span class="n">pdb_filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_optimisation</span><span class="p">:</span>
        <span class="n">rmol</span><span class="o">.</span><span class="n">optimise_in_receptor</span><span class="p">(</span>
            <span class="n">receptor_file</span><span class="o">=</span><span class="n">pdb_filename</span><span class="p">,</span>
            <span class="n">ligand_force_field</span><span class="o">=</span><span class="s2">&quot;openff&quot;</span><span class="p">,</span>
            <span class="n">use_ani</span><span class="o">=</span><span class="n">ani</span><span class="p">,</span>
            <span class="n">sigma_scale_factor</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
            <span class="n">relative_permittivity</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">water_model</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">platform_name</span><span class="o">=</span><span class="n">platform</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">rmol</span><span class="o">.</span><span class="n">GetNumConformers</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No Conformers&quot;</span><span class="p">)</span>

        <span class="n">rmol</span><span class="o">.</span><span class="n">sort_conformers</span><span class="p">(</span><span class="n">energy_range</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># kcal/mol</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">scoring_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cnnaffinities</span> <span class="o">=</span> <span class="n">rmol</span><span class="o">.</span><span class="n">gnina</span><span class="p">(</span><span class="n">receptor_file</span><span class="o">=</span><span class="n">pdb_filename</span><span class="p">,</span> <span class="n">gnina_gpu</span><span class="o">=</span><span class="n">gnina_gpu</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cnnaffinities&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">affinity</span><span class="p">)</span> <span class="k">for</span> <span class="n">affinity</span> <span class="ow">in</span> <span class="n">cnnaffinities</span><span class="o">.</span><span class="n">CNNaffinity</span><span class="p">]}</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;cnnaffinities&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">score</span> <span class="o">=</span> <span class="n">scoring_function</span><span class="p">(</span><span class="n">rmol</span><span class="p">,</span> <span class="n">pdb_filename</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>
    <span class="k">return</span> <span class="n">rmol</span><span class="p">,</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../conformers/" class="md-footer__link md-footer__link--prev" aria-label="Previous: &lt;code class=&#34;doc-symbol doc-symbol-nav doc-symbol-module&#34;&gt;&lt;/code&gt; conformers">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> conformers
              </div>
            </div>
          </a>
        
        
          
          <a href="../receptor/" class="md-footer__link md-footer__link--next" aria-label="Next: &lt;code class=&#34;doc-symbol doc-symbol-nav doc-symbol-module&#34;&gt;&lt;/code&gt; receptor">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                <code class="doc-symbol doc-symbol-nav doc-symbol-module"></code> receptor
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025 Newcastle University
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>